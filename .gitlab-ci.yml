test_docu:
  image: python:2.7
  stage: test

  services:
    - docker

  variables:
    TEST_ARG: "make test-documentation"
    # CI_DEBUG_TRACE: "true"

  before_script:
    - apt-get -qq update
    - apt-get -qq install -y tidy
    - export PYTHONIOENCODING=UTF8 # just in case
    - pip install --upgrade pip setuptools wheel
    - pip install --only-binary=numpy,scipy,matplotlib numpy scipy matplotlib
    - pip install git+https://github.com/lbl-srg/BuildingsPy@master

  script:
    - (cd AixLib/Resources/Scripts/travis && $TEST_ARG)

test_autogenerated_files:
  image: python:2.7
  stage: test

  services:
    - docker

  variables:
    TEST_ARG: "make test-autogenerated-files"
    # CI_DEBUG_TRACE: "true"

  before_script:
    - apt-get -qq update
    - apt-get -qq install -y tidy
    - export PYTHONIOENCODING=UTF8 # just in case
    - pip install --upgrade pip setuptools wheel
    - pip install --only-binary=numpy,scipy,matplotlib numpy scipy matplotlib
    - pip install git+https://github.com/lbl-srg/BuildingsPy@master

  script:
    - (cd AixLib/Resources/Scripts/travis && $TEST_ARG)

test_Air:
  image: python:2.7
  stage: test

  services:
    - docker

  variables:
    TEST_ARG: "make test-dymola PACKAGE=\"AixLib.ThermalZones.ReducedOrder\""
    # CI_DEBUG_TRACE: "true"

  before_script:

    - docker login -u "$CI_DEPLOY_USER" -p "$CI_DEPLOY_PASSWORD" registry.git.rwth-aachen.de && docker pull registry.git.rwth-aachen.de/ebc/ebc_intern/dymola-docker:tag
    - chmod +x AixLib/Resources/Scripts/travis/bin/dymola
    - mkdir $HOME/bin
    - cp AixLib/Resources/Scripts/travis/bin/dymola $HOME/bin/
    - apt-get -qq update
    - apt-get -qq install -y tidy
    - export PYTHONIOENCODING=UTF8 # just in case
    - pip install --upgrade pip setuptools wheel
    - pip install --only-binary=numpy,scipy,matplotlib numpy scipy matplotlib
    - pip install git+https://github.com/lbl-srg/BuildingsPy@master

  script:
    - (cd AixLib/Resources/Scripts/travis && $TEST_ARG)


test_dymola_thermalzones:
  image: registry.git.rwth-aachen.de/ebc/ebc_intern/dymola-docker:conda-integration
  stage: test
  services:
    -  docker
  before_script:
    - Xvfb :77 -extension RANDR -extension GLX & export DISPLAY=:77.0 &&
    - conda create -n python27 python=2.7 -y
    - source activate python27
    - python -V               # Print out python version for debugging
    - dir
    - conda install numpy scipy matplotlib -y
    - export PYTHONIOENCODING=UTF8 # just in case
    - pip install git+https://github.com/lbl-srg/BuildingsPy@master

  script:
    - cd AixLib && python Resources/Scripts/runUnitTests.py --batch --single-package AixLib.ThermalZones --tool dymola


test_dymola_airflow:
  image: registry.git.rwth-aachen.de/ebc/ebc_intern/dymola-docker:conda-integration
  stage: test
  services:
    -  docker
  before_script:
    - Xvfb :77 -extension RANDR -extension GLX & export DISPLAY=:77.0 &&
    - conda create -n python27 python=2.7 -y
    - source activate python27
    - python -V               # Print out python version for debugging
    - dir
    - conda install numpy scipy matplotlib -y
    - export PYTHONIOENCODING=UTF8 # just in case
    - pip install git+https://github.com/lbl-srg/BuildingsPy@master

  script:
    - cd AixLib && python Resources/Scripts/runUnitTests.py --batch --single-package AixLib.Airflow --tool dymola
 
